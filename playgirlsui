-- [[ /PLAYGIRLS UNIFIED HUB V4 ]] --
-- FIXED MB2 FLAMELOCK ACTIVATION
-- RESTORED FULL SCRIPT & PARALLEL EXECUTION
-- DO NOT REMOVE ANY LINES

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- [[ INITIAL AD ]] --
local sgAd = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
sgAd.Name = "PlayGirls_Ad"
sgAd.ResetOnSpawn = false
local adLabel = Instance.new("TextLabel", sgAd)
adLabel.Size = UDim2.new(1, 0, 1, 0)
adLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
adLabel.BackgroundTransparency = 0.2
adLabel.Text = "/playgirls"
adLabel.TextColor3 = Color3.fromRGB(255, 105, 180)
adLabel.Font = Enum.Font.GothamBold
adLabel.TextSize = 80
adLabel.ZIndex = 100

task.delay(2.5, function()
    for i = 0, 1, 0.1 do
        adLabel.TextTransparency = i
        adLabel.BackgroundTransparency = i + 0.2
        task.wait(0.05)
    end
    sgAd:Destroy()
end)

-- [[ CONFIGS ]] --
local GlobalSettings = {
    Visible = true,
    HideAllKey = Enum.KeyCode.X 
}

local MagnetSettings = {
    MasterEnabled = false,
    Enabled = false,
    LockKey = Enum.KeyCode.Q,
    MagnetStrength = 1,
    TargetPart = "UpperTorso"
}

local FogPresets = {
    ["Neon Red"] = {Color = Color3.fromRGB(255, 70, 70), Density = 0.45},    
    ["Deep Pink"] = {Color = Color3.fromRGB(255, 20, 147), Density = 0.48},  
    ["Electric Blue"] = {Color = Color3.fromRGB(0, 255, 255), Density = 0.51}, 
    ["Toxic Green"] = {Color = Color3.fromRGB(50, 255, 50), Density = 0.49},  
    ["Void Purple"] = {Color = Color3.fromRGB(138, 43, 226), Density = 0.56}, 
    ["Hell Orange"] = {Color = Color3.fromRGB(255, 140, 0), Density = 0.43}   
}
local OrigFogStart, OrigFogEnd, OrigFogColor = Lighting.FogStart, Lighting.FogEnd, Lighting.FogColor
local OrigAtmosphere = Lighting:FindFirstChildOfClass("Atmosphere") and Lighting:FindFirstChildOfClass("Atmosphere"):Clone() or nil

local TriggerSettings = {
    MasterEnabled = false,
    TriggerKey = Enum.KeyCode.T,
    Mode = "Hold",
    Active = false,
    ClickDelay = 0.02,
    Blacklist = {"Knife", "Wallet", "Phone", "Chicken", "Pizza", "Flashlight", "Medkit"}
}

local FlameConfig = {
    MasterLock = false,
    MasterSpeed = false,
    LockActive = false,
    SpeedActive = false,
    MouseLockKey = Enum.KeyCode.Z, 
    WalkSpeedKey = Enum.KeyCode.J,
    UseRightClick = false,
    ActivationType = "Hold", 
    Smoothness = 0.71,
    Prediction = 0.250,
    LeftOffset = 2.34,
    UpOffset = -10.53,
    HitPart = 'HumanoidRootPart',
    WalkSpeedValue = 100,
}

local locations = {
    ["Double Barrel"] = CFrame.new(-1039, 18, -256),
    ["Armour"] = CFrame.new(-607, 7, -788),
    ["Shotgun"] = CFrame.new(-582, 7, -733),
    ["Tactical Shotgun"] = CFrame.new(485, 48, -615),
    ["Mil"] = CFrame.new(35, 25, -840)
}

-- [[ UI SETUP ]] --
local MainGui = Instance.new("ScreenGui", game.CoreGui)
local MainFrame = Instance.new("Frame", MainGui)
local UICorner = Instance.new("UICorner", MainFrame)
local UIStroke = Instance.new("UIStroke", MainFrame)

MainFrame.Name = "PlayGirlsMain"
MainFrame.Size = UDim2.new(0, 500, 0, 420)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -210)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.Active = true
MainFrame.Draggable = true

UICorner.CornerRadius = UDim.new(0, 10)
UIStroke.Color = Color3.fromRGB(255, 20, 147)
UIStroke.Thickness = 2

local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0, 120, 1, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, 10)

local Title = Instance.new("TextLabel", Sidebar)
Title.Size = UDim2.new(1, 0, 0, 50)
Title.Text = "/PLAYGIRLS"
Title.TextColor3 = Color3.fromRGB(255, 20, 147)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.BackgroundTransparency = 1

local Container = Instance.new("Frame", MainFrame)
Container.Size = UDim2.new(1, -130, 1, -20)
Container.Position = UDim2.new(0, 125, 0, 10)
Container.BackgroundTransparency = 1

local Pages = {}
local function CreatePage(name)
    local Page = Instance.new("ScrollingFrame", Container)
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.Visible = false
    Page.ScrollBarThickness = 2
    local Layout = Instance.new("UIListLayout", Page)
    Layout.Padding = UDim.new(0, 5)
    Pages[name] = Page
    return Page
end

local CombatPage = CreatePage("Combat")
local VisualPage = CreatePage("Visuals")
local TeleportPage = CreatePage("Teleport")
local SpeedPage = CreatePage("Speed")

local function ShowPage(name)
    for _, p in pairs(Pages) do p.Visible = false end
    Pages[name].Visible = true
end

local function CreateTabBtn(name, offset)
    local btn = Instance.new("TextButton", Sidebar)
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.Position = UDim2.new(0.05, 0, 0, offset)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamSemibold
    btn.TextSize = 12
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function() ShowPage(name) end)
end

CreateTabBtn("Combat", 60)
CreateTabBtn("Visuals", 100)
CreateTabBtn("Teleport", 140)
CreateTabBtn("Speed", 180) 
ShowPage("Combat")

local function CreateHeader(parent, text)
    local l = Instance.new("TextLabel", parent)
    l.Size = UDim2.new(0.95, 0, 0, 30)
    l.Text = "— " .. text .. " —"
    l.BackgroundTransparency = 1
    l.TextColor3 = Color3.fromRGB(180, 180, 180)
    l.Font = Enum.Font.GothamBold
    l.TextSize = 13
end

local function CreateToggle(parent, text, bindText, default, callback)
    local frame = Instance.new("Frame", parent)
    frame.Size = UDim2.new(0.95, 0, 0, 35)
    frame.BackgroundTransparency = 1
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(1, 0, 1, 0)
    btn.Text = text .. (default and ": ON" or ": OFF")
    btn.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    btn.TextColor3 = default and Color3.fromRGB(255, 20, 147) or Color3.new(1,1,1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 12
    Instance.new("UICorner", btn)
    if bindText then
        local bindLabel = Instance.new("TextLabel", btn)
        bindLabel.Size = UDim2.new(0, 40, 1, 0)
        bindLabel.Position = UDim2.new(1, -45, 0, 0)
        bindLabel.Text = "["..bindText.."]"
        bindLabel.TextColor3 = Color3.fromRGB(100, 100, 100)
        bindLabel.BackgroundTransparency = 1
        bindLabel.Font = Enum.Font.Gotham
        bindLabel.TextSize = 10
        bindLabel.TextXAlignment = Enum.TextXAlignment.Right
    end
    local state = default
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = text .. (state and ": ON" or ": OFF")
        btn.TextColor3 = state and Color3.fromRGB(255, 20, 147) or Color3.new(1,1,1)
        callback(state)
    end)
    return btn
end

local function CreateModeSelector(parent, label, default, callback)
    local frame = Instance.new("Frame", parent)
    frame.Size = UDim2.new(0.95, 0, 0, 35)
    frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Instance.new("UICorner", frame)
    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(0.4, 0, 1, 0)
    title.Position = UDim2.new(0.05, 0, 0, 0)
    title.Text = label .. ":"
    title.TextColor3 = Color3.new(1,1,1)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.Gotham
    title.TextSize = 12
    title.TextXAlignment = Enum.TextXAlignment.Left
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(0.5, 0, 1, 0)
    btn.Position = UDim2.new(0.45, 0, 0, 0)
    btn.BackgroundTransparency = 1
    btn.Font = Enum.Font.GothamSemibold
    btn.TextSize = 12
    local function updateText(mode)
        if mode == "Hold" then
            btn.RichText = true
            btn.Text = '<font color="rgb(255, 20, 147)">Hold</font> / <font color="rgb(100, 100, 100)">Toggle</font>'
        else
            btn.RichText = true
            btn.Text = '<font color="rgb(100, 100, 100)">Hold</font> / <font color="rgb(255, 20, 147)">Toggle</font>'
        end
    end
    local current = default
    updateText(current)
    btn.MouseButton1Click:Connect(function()
        current = (current == "Hold" and "Toggle" or "Hold")
        updateText(current)
        callback(current)
    end)
end

local function CreateSpeedDial(parent, text, min, max, default, callback)
    local sliderFrame = Instance.new("Frame", parent)
    sliderFrame.Size = UDim2.new(0.95, 0, 0, 55)
    sliderFrame.BackgroundTransparency = 1
    local label = Instance.new("TextLabel", sliderFrame)
    label.Size = UDim2.new(1, 0, 0, 20); label.Text = text .. ": " .. default; label.TextColor3 = Color3.new(1,1,1); label.BackgroundTransparency = 1; label.Font = Enum.Font.Gotham; label.TextSize = 12; label.TextXAlignment = Enum.TextXAlignment.Left
    local tray = Instance.new("Frame", sliderFrame)
    tray.Size = UDim2.new(1, 0, 0, 8); tray.Position = UDim2.new(0, 0, 0, 30); tray.BackgroundColor3 = Color3.fromRGB(30, 30, 30); Instance.new("UICorner", tray)
    local fill = Instance.new("Frame", tray)
    fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0); fill.BackgroundColor3 = Color3.fromRGB(255, 20, 147); Instance.new("UICorner", fill)
    local function update(input)
        local pos = math.clamp((input.Position.X - tray.AbsolutePosition.X) / tray.AbsoluteSize.X, 0, 1)
        local val = math.floor(min + (max - min) * pos)
        fill.Size = UDim2.new(pos, 0, 1, 0); label.Text = text .. ": " .. val; callback(val)
    end
    local dragging = false
    tray.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true update(input) end end)
    UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then update(input) end end)
    UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
end

-- [[ PAGE POPULATION ]] --
CreateHeader(CombatPage, "TRIGGERBOT")
CreateToggle(CombatPage, "Triggerbot", "T", false, function(v) TriggerSettings.MasterEnabled = v end)
CreateModeSelector(CombatPage, "Activation", "Hold", function(m) TriggerSettings.Mode = m end)

CreateHeader(CombatPage, "FLAMELOCK")
CreateToggle(CombatPage, "Flamelock", "Z", false, function(v) FlameConfig.MasterLock = v end)
CreateModeSelector(CombatPage, "Activation", "Hold", function(m) FlameConfig.ActivationType = m end)
CreateToggle(CombatPage, "Use Right Click", "MB2", false, function(v) FlameConfig.UseRightClick = v end)

CreateHeader(CombatPage, "MAGNET/LOCK")
CreateToggle(CombatPage, "Mouselock", "Q", false, function(v) 
    MagnetSettings.MasterEnabled = v 
    if not v then MagnetSettings.Enabled = false end 
end)

CreateHeader(VisualPage, "ATMOSPHERE PRESETS")
for name, data in pairs(FogPresets) do
    local btn = Instance.new("TextButton", VisualPage)
    btn.Size = UDim2.new(0.95, 0, 0, 30); btn.Text = name; btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20); btn.TextColor3 = data.Color
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function()
        for _, v in ipairs(Lighting:GetChildren()) do if v:IsA("Atmosphere") then v:Destroy() end end
        local atm = Instance.new("Atmosphere", Lighting); atm.Color = data.Color; atm.Density = data.Density; atm.Haze = 4
        Lighting.FogStart = 30; Lighting.FogEnd = 200
    end)
end

local RestoreBtn = Instance.new("TextButton", VisualPage)
RestoreBtn.Size = UDim2.new(0.95, 0, 0, 35); RestoreBtn.Text = "Restore Game Fog"; RestoreBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30); RestoreBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", RestoreBtn)
RestoreBtn.MouseButton1Click:Connect(function()
    for _, v in ipairs(Lighting:GetChildren()) do if v:IsA("Atmosphere") then v:Destroy() end end
    if OrigAtmosphere then OrigAtmosphere:Clone().Parent = Lighting end
    Lighting.FogStart = OrigFogStart; Lighting.FogEnd = OrigFogEnd; Lighting.FogColor = OrigFogColor
end)

for name, cf in pairs(locations) do
    local btn = Instance.new("TextButton", TeleportPage)
    btn.Size = UDim2.new(0.95, 0, 0, 35); btn.Text = name; btn.BackgroundColor3 = Color3.fromRGB(25, 25, 25); btn.TextColor3 = Color3.fromRGB(255, 105, 180); Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function() if LocalPlayer.Character then LocalPlayer.Character:PivotTo(cf + Vector3.new(0, 0.5, 0)) end end)
end

CreateHeader(SpeedPage, "MOVEMENT")
CreateToggle(SpeedPage, "Speed Master", "J", false, function(v) FlameConfig.MasterSpeed = v; FlameConfig.SpeedActive = v end)
CreateSpeedDial(SpeedPage, "Speed Dial", 16, 1000, 100, function(v) FlameConfig.WalkSpeedValue = v end)

CreateHeader(SpeedPage, "HUB INFO")
local CredsLabel = Instance.new("TextLabel", SpeedPage); CredsLabel.Size = UDim2.new(0.95, 0, 0, 50); CredsLabel.BackgroundTransparency = 1; CredsLabel.Text = "Made by hitmycel and t5inted <3"; CredsLabel.TextColor3 = Color3.fromRGB(255, 20, 147); CredsLabel.Font = Enum.Font.GothamBold; CredsLabel.TextSize = 14

-- [[ LOGIC ]] --

local function getMagnetTarget()
    local closest, shortest = nil, math.huge
    local mPos = UserInputService:GetMouseLocation()
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild(MagnetSettings.TargetPart) then
            local pos, _ = Camera:WorldToViewportPoint(v.Character[MagnetSettings.TargetPart].Position)
            local dist = (Vector2.new(pos.X, pos.Y) - mPos).Magnitude
            if dist < shortest then closest = v; shortest = dist end
        end
    end
    return closest
end

local function getFlameTarget()
    local closest, shortest = nil, math.huge
    local mPos = UserInputService:GetMouseLocation()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild(FlameConfig.HitPart) then
            local part = plr.Character[FlameConfig.HitPart]
            local sPos, onScreen = Camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local dist = (Vector2.new(mPos.X, mPos.Y) - Vector2.new(sPos.X, sPos.Y)).Magnitude
                if dist < shortest then closest = part; shortest = dist end
            end
        end
    end
    return closest
end

local magTarget = nil
local flameTargetPart = nil

UserInputService.InputBegan:Connect(function(i, p)
    if p then return end
    if i.KeyCode == MagnetSettings.LockKey and MagnetSettings.MasterEnabled then
        MagnetSettings.Enabled = not MagnetSettings.Enabled
        magTarget = MagnetSettings.Enabled and getMagnetTarget() or nil
    elseif i.KeyCode == FlameConfig.WalkSpeedKey and FlameConfig.MasterSpeed then
        FlameConfig.SpeedActive = not FlameConfig.SpeedActive
    elseif i.KeyCode == GlobalSettings.HideAllKey then 
        GlobalSettings.Visible = not GlobalSettings.Visible
        MainFrame.Visible = GlobalSettings.Visible
    elseif i.KeyCode == TriggerSettings.TriggerKey then
        if TriggerSettings.Mode == "Toggle" then TriggerSettings.Active = not TriggerSettings.Active else TriggerSettings.Active = true end
    
    -- FLAMELOCK LOGIC (FIXED MB2)
    elseif (FlameConfig.UseRightClick and i.UserInputType == Enum.UserInputType.MouseButton2) or (not FlameConfig.UseRightClick and i.KeyCode == FlameConfig.MouseLockKey) then
        if FlameConfig.MasterLock then
            if FlameConfig.ActivationType == "Toggle" then
                FlameConfig.LockActive = not FlameConfig.LockActive
                flameTargetPart = FlameConfig.LockActive and getFlameTarget() or nil
            else
                FlameConfig.LockActive = true
                flameTargetPart = getFlameTarget()
            end
        end
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.KeyCode == TriggerSettings.TriggerKey and TriggerSettings.Mode == "Hold" then 
        TriggerSettings.Active = false
    -- FLAMELOCK END (FIXED MB2)
    elseif (FlameConfig.UseRightClick and i.UserInputType == Enum.UserInputType.MouseButton2) or (not FlameConfig.UseRightClick and i.KeyCode == FlameConfig.MouseLockKey) then
        if FlameConfig.ActivationType == "Hold" then FlameConfig.LockActive = false end
    end
end)

RunService.Heartbeat:Connect(function()
    if FlameConfig.MasterSpeed and FlameConfig.SpeedActive then
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum and hum.MoveDirection.Magnitude > 0 then
            char:TranslateBy(hum.MoveDirection * (FlameConfig.WalkSpeedValue / 100))
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if MagnetSettings.Enabled and magTarget and magTarget.Character and magTarget.Character:FindFirstChild(MagnetSettings.TargetPart) then
        local tPos, _ = Camera:WorldToViewportPoint(magTarget.Character[MagnetSettings.TargetPart].Position)
        local delta = (Vector2.new(tPos.X, tPos.Y) - UserInputService:GetMouseLocation()) * MagnetSettings.MagnetStrength
        if mousemoverel then mousemoverel(delta.X, delta.Y) end
    end
    if FlameConfig.MasterLock and FlameConfig.LockActive and flameTargetPart and flameTargetPart.Parent then
        local tPos = flameTargetPart.Position + (flameTargetPart.Velocity * FlameConfig.Prediction)
        local offset = (Camera.CFrame.RightVector * FlameConfig.LeftOffset) + Vector3.new(0, FlameConfig.UpOffset, 0)
        local fScreen, onScreen = Camera:WorldToViewportPoint(tPos + offset)
        if onScreen then
            local mPos = UserInputService:GetMouseLocation()
            pcall(function() mousemoverel((fScreen.X - mPos.X) * FlameConfig.Smoothness, (fScreen.Y - mPos.Y) * FlameConfig.Smoothness) end)
        end
    end
    if TriggerSettings.MasterEnabled and TriggerSettings.Active then
        local target = Mouse.Target
        if target and target.Parent then
            local hum = target.Parent:FindFirstChild("Humanoid") or target.Parent.Parent:FindFirstChild("Humanoid")
            if hum and hum.Parent.Name ~= LocalPlayer.Name then
                if mouse1click then mouse1click() task.wait(TriggerSettings.ClickDelay) end
            end
        end
    end
end)

print("/playgirls: V4 Fully Restored + MB2 Fixed + Speed Dial Working.")
